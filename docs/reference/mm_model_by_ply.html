<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Splits up to two data.frames, data and data_daily, into date-specific chunks.
These are passed to model_fun. If day_tests is not empty, those
validity checks are run and the results are also passed to model_fun (in
validity). The results of model_fun (which must be a data.frame) are
modified to include the data as a first column, then row-bound together into
a single data.frame containing results from all days."><title>Split and label data into &gt;=24-hr days for fitting daily metabolism — mm_model_by_ply • streamMetabolizer</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Split and label data into &gt;=24-hr days for fitting daily metabolism — mm_model_by_ply"><meta property="og:description" content="Splits up to two data.frames, data and data_daily, into date-specific chunks.
These are passed to model_fun. If day_tests is not empty, those
validity checks are run and the results are also passed to model_fun (in
validity). The results of model_fun (which must be a data.frame) are
modified to include the data as a first column, then row-bound together into
a single data.frame containing results from all days."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">streamMetabolizer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.12.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/data_prep.html">Data Preparation</a>
    <a class="dropdown-item" href="../articles/get_started.html">Quickstart</a>
    <a class="dropdown-item" href="../articles/gpp_er_eqs.html">GPP and ER Equations</a>
    <a class="dropdown-item" href="../articles/installation.html">Installation</a>
    <a class="dropdown-item" href="../articles/model_structures.html">Model Structures</a>
    <a class="dropdown-item" href="../articles/models_bayes.html">Bayesian Models</a>
    <a class="dropdown-item" href="../articles/models_mle.html">MLE Models</a>
    <a class="dropdown-item" href="../articles/ode_methods.html">ODE Methods</a>
    <a class="dropdown-item" href="../articles/simulations.html">Simulations</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/USGS-R/streamMetabolizer/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Split and label data into &gt;=24-hr days for fitting daily metabolism</h1>
      <small class="dont-index">Source: <a href="https://github.com/USGS-R/streamMetabolizer/blob/HEAD/R/mm_model_by_ply.R" class="external-link"><code>R/mm_model_by_ply.R</code></a></small>
      <div class="d-none name"><code>mm_model_by_ply.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Splits up to two data.frames, data and data_daily, into date-specific chunks.
These are passed to model_fun. If <code>day_tests</code> is not empty, those
validity checks are run and the results are also passed to model_fun (in
<code>validity</code>). The results of model_fun (which must be a data.frame) are
modified to include the data as a first column, then row-bound together into
a single data.frame containing results from all days.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">mm_model_by_ply</span><span class="op">(</span></span>
<span>  <span class="va">model_fun</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  data_daily <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">day_start</span>,</span>
<span>  <span class="va">day_end</span>,</span>
<span>  day_tests <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"full_day"</span>, <span class="st">"even_timesteps"</span>, <span class="st">"complete_data"</span>, <span class="st">"pos_discharge"</span>,</span>
<span>    <span class="st">"pos_depth"</span><span class="op">)</span>,</span>
<span>  required_timestep <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  timestep_days <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>model_fun</dt>
<dd><p>the function to apply to each data ply. This function should
accept the arguments <code>c(data, data_daily, ..., day_start, day_end,
ply_date)</code> where <code>data_daily</code> is <code>NULL</code> when the
<code>data_daily</code> argument to <code>mm_model_by_ply</code> is missing or
<code>NULL</code></p></dd>


<dt>data</dt>
<dd><p>required. A data.frame to split into chunks by date, where a
'date' begins on the hour day_start and ends at the hour day_end. The
solar.time column must be present.</p></dd>


<dt>data_daily</dt>
<dd><p>optional. A data.frame containing inputs with a daily
timestep, each row of which will be passed to the corresponding date chunk
from <code>data</code>. The date column must be present.</p></dd>


<dt>day_start</dt>
<dd><p>start time (inclusive) of a day's data in number of hours
from the midnight that begins the date. For example, day_start=-1.5
indicates that data describing 2006-06-26 begin at 2006-06-25 22:30, or at
the first observation time that occurs after that time if day_start doesn't
fall exactly on an observation time. For metabolism models working with
single days of input data, it is conventional/useful to begin the day the
evening before, e.g., -1.5, and to end just before the next sunrise, e.g.,
30. For multiple consecutive days, it may make the most sense to start just
before sunrise (e.g., 4) and to end 24 hours later. For nighttime
regression, the date assigned to a chunk of data should be the date whose
evening contains the data. The default is therefore 12 to 36 for
metab_night, of which the times of darkness will be used.</p></dd>


<dt>day_end</dt>
<dd><p>end time (exclusive) of a day's data in number of hours from
the midnight that begins the date. For example, day_end=30 indicates that
data describing 2006-06-26 end at the last observation time that occurs
before 2006-06-27 06:00. See day_start for recommended start and end times.</p></dd>


<dt>day_tests</dt>
<dd><p>list of tests to conduct to determine whether each date
worth of data is valid for modeling. The results of these tests will be
combined with the result of the test implied if <code>required_timestep</code> is
numeric and then will be passed to <code>model_fun</code> as the
<code>ply_validity</code> argument to that function.</p></dd>


<dt>required_timestep</dt>
<dd><p>NA or numeric (length 1). If numeric, the timestep
length in days that a date must have to pass the validity check (to within
a tolerance of 0.2% of the value of <code>required_timestep</code>). The result
of this test will be combined with the results of the tests listed in
<code>day_tests</code> and reported to <code>model_fun</code> as the
<code>ply_validity</code> argument to that function.</p></dd>


<dt>timestep_days</dt>
<dd><p>TRUE if you would like the mean timestep length to be
calculated for each data ply and passed to <code>model_fun</code> as the
<code>timestep_days</code> argument to that function. Alternatively, this may be
numeric as a specifically expected timestep length in days; for example, a
1-hour timestep is 1/24 is 0.0416667.</p></dd>


<dt>...</dt>
<dd><p>other args to be passed through mm_model_by_ply to model_fun</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>a data.frame of model results</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="data_metab.html">data_metab</a></span><span class="op">(</span><span class="st">'10'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">mm_model_by_ply</span><span class="op">(</span><span class="va">mm_model_by_ply_prototype</span>, data<span class="op">=</span><span class="va">dat</span>, day_start<span class="op">=</span><span class="fl">2</span>, day_end<span class="op">=</span><span class="fl">28</span><span class="op">)</span><span class="op">$</span><span class="va">date</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "2012-09-18" "2012-09-19" "2012-09-20" "2012-09-21" "2012-09-22"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6] "2012-09-23" "2012-09-24" "2012-09-25" "2012-09-26" "2012-09-27"</span>
<span class="r-in"><span><span class="fu">mm_model_by_ply</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>text<span class="op">=</span><span class="st">'hi'</span><span class="op">)</span><span class="op">}</span>,</span></span>
<span class="r-in"><span>  data<span class="op">=</span><span class="va">dat</span>, day_start<span class="op">=</span><span class="fl">2</span>, day_end<span class="op">=</span><span class="fl">28</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          date text</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  2012-09-18   hi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  2012-09-19   hi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  2012-09-20   hi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  2012-09-21   hi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  2012-09-22   hi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  2012-09-23   hi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  2012-09-24   hi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  2012-09-25   hi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  2012-09-26   hi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 2012-09-27   hi</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Alison P. Appling, Robert O. Hall, Maite Arroita, Charles B. Yackulic.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

